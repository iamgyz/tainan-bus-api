<?php 
/*
Author: GYZheng (gyzheng@cs.nctu.edu.tw)
Update: 2015/8/9
*/
$r = $_GET['route'];
$id["city"]=array(
                "0左"=>"10450",
                "0右"=>"10451",
                "1"=>"10160",
                "2"=>"10162",
                "3"=>"10163",
                "5"=>"10164",
                "6"=>"10165",
                "7"=>"10166",
                "9"=>"10167",
                "10"=>"10168",
                "11"=>"10169",
                "14"=>"10170",
                "15"=>"10452",
                "18"=>"10161",
                "20"=>"10020",
                "21"=>"10021"
                );

$id["hsr"]=array(
                "H62"=>"10265",
                "H31"=>"10262"
                );
$id["green"]=array(
                "綠幹線"=>"1100",
                "綠1"=>"1101",
                "綠2"=>"1102",
                "綠3"=>"1103",
                "綠4"=>"1104",
                "綠5"=>"1105",
                "綠6"=>"1106",
                "綠7"=>"1107",
                "綠10"=>"1110",
                "綠11"=>"1111",
                "綠12"=>"1112",
                "綠13"=>"1113",
                "綠14"=>"1114",
                "綠15"=>"1115",
                "綠16"=>"1116",
                "綠17"=>"1117",
                "綠20"=>"1120",
                "綠21"=>"1121",
                "綠22"=>"1122",
                "綠23"=>"1123",
                "綠24"=>"1124",
                "綠25"=>"1125",
                "綠26"=>"1126",
                "綠27"=>"1127"

                );
$id["blue"]=array(
                "藍幹線"=>"1200",
                "藍1"=>"1201",
                "藍2"=>"1202",
                "藍3"=>"1203",
                "藍10"=>"1210",
                "藍11"=>"1211",
                "藍12"=>"1212",
                "藍13"=>"1213",
                "藍20"=>"1220",
                "藍21"=>"1221",
                "藍22"=>"1222",
                "藍23"=>"1223",
                "藍24"=>"1224",
                "藍25"=>"1225"
                );
$id["brown"]=array(
                "棕幹線"=>"1300",
                "棕1"=>"1301",
                "棕2"=>"1302",
                "棕3"=>"1303",
                "棕10"=>"1310",
                "棕11"=>"1311"
                );
$id["orange"]=array(
                "橘幹線"=>"1400",
                "橘1"=>"1401",
                "橘2"=>"1402",
                "橘3"=>"1403",
                "橘4"=>"1404",
                "橘5"=>"1405",
                "橘10"=>"1410",
                "橘11"=>"1411",
                "橘12"=>"1412",
                "橘20"=>"1420"
                );
$id["yellow"]=array(
                "黃幹線"=>"1500",
                "黃1"=>"1501",
                "黃2"=>"1502",
                "黃3"=>"1503",
                "黃4"=>"1504",
                "黃5"=>"1505",
                "黃6"=>"1506",
                "黃7"=>"1507",
                "黃9"=>"1509",
                "黃10"=>"1510",
                "黃11"=>"1511",
                "黃12"=>"1512",
                "黃13"=>"1513",
                "黃14"=>"1514",
                "黃15"=>"1515",
                "黃20"=>"1520"
                );
$id["red"]=array(
                "紅幹線"=>"1600",
                "紅1"=>"1601",
                "紅2"=>"1602",
                "紅3"=>"1603",
                "紅4"=>"1604",
                "紅10"=>"1610",
                "紅11"=>"1611",
                "紅12"=>"1612",
                "紅13"=>"1613",
                "紅14"=>"1614"
                );
$id["travel"]=array(
                "88"=>"10211",
                "99"=>"10210"
                );

$output = array();
$total=0;
foreach($id[$r] as $k=>$v)
{
        $url = "http://2384.tainan.gov.tw:8080/AGPSRemoteQuery3/agpsremotequery?object=cars&source=imp&path_id=".$v;
        $content = file_get_contents($url);
        $line = preg_split("/;/",$content);	
        foreach($line as $l)
        {		
                $ele = preg_split("/,/",$l);
                if(count($ele)>4)
                {
                        $output[$total++]= array("route"=>$k,"plate"=>$ele[0],"latitude"=>$ele[4],"longitude"=>$ele[5],"direction"=>$ele[12]);
                }
        }
}
echo json_encode($output,JSON_PRETTY_PRINT);
?> 





